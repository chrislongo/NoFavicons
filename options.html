<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
    "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
    <head>
    <title>No Favicons Extension Options</title>

    <style type="text/css"> 
        body{background-color:#fff;color:#000;font-family:Verdana, Arial, sans-serif;font-size:small;line-height:175%;margin:10px;}
        h1{font-size:small;font-weight:700;}
        img{vertical-align:middle;}
        #selection{margin-left:15px;}
        #upload{position:relative;text-align:right;-moz-opacity:0;filter:alpha(opacity: 0);opacity:0;z-index:2;}
        #uploadtext{position:absolute;top:0;left:155px;z-index:1;}
        #userimagearea{width:16px;height:16px;visibility:hidden;}
        #fileinputs{position:relative;}
    </style> 

    <script type="text/javascript">
        function save() 
        {
            updateStatus("");

            var imageType = getSelectedImageType();
            var userImage = getLoadedUserImage();

            localStorage["preferences"] = 
                JSON.stringify({ imagetype:imageType, userimage:userImage });
        }

        function load() 
        {
            var serialized = localStorage["preferences"];

            if(!serialized)
                return;

            var prefs = JSON.parse(serialized);
        
            if(prefs)
            {
                var imageType = (prefs.imagetype) ? prefs.imagetype : "dashed";
                
                var buttons = document.getElementsByName("imagetype");

                for(var i = 0; i < buttons.length; i++) 
                {
                    var child = buttons[i];

                    if(child.value == imageType) 
                    {
                        child.checked = true;
                        break;
                    }
                }

                var imageArea = document.getElementById("userimagearea");

                if(prefs.userimage)
                {
                    imageArea.src = prefs.userimage; 
                    imageArea.style.visibility = "visible";
                }
            }
        }

        function getSelectedImageType()
        {
            var buttons = document.getElementsByName("imagetype");
            var imageType;

            for(var i = 0; i < buttons.length; i++) 
            {
                var child = buttons[i];

                if(child.checked) 
                {
                    imageType = child.value;
                    break;
                }
            }            

            return imageType;
        }

        function getLoadedUserImage()
        {
            return document.getElementById("userimagearea").src;    
        }

        function loadImageFile()
        {
            var reader = new FileReader();
            var imageArea = document.getElementById("userimagearea");

            updateStatus("");

            reader.onloadend = function(e)
            {
                imageArea.src = e.target.result;
                imageArea.style.visibility = "visible";

                document.getElementById("userradio").checked = true;
                save();
            };

            var file = document.getElementById("upload").files[0];

            if(!/image\//.test(file.type))
            {
                updateStatus("Not an image")
                load();
                return;
            }

            reader.readAsDataURL(file);
        }

        function updateStatus(text)
        {
            document.getElementById("status").innerHTML = text;    
        }
    </script>
</head>

<body onload="load()">
    <h1>Icon type to replace favicons with in tabs and bookmarks</h1>

    <div id="selection">
        <input type="radio" id="dashedradio" name="imagetype" value="dashed" onclick="save()" checked> Simple dashed outline: 
        <img src="image/dashed.png" alt=""/><br />
        <input type="radio" id="pageradio" name="imagetype" value="page" onclick="save()"> A clean white icon: 
        <img src="image/page.png" alt="" /><br />
        <input type="radio" id="defaultradio" name="imagetype" value="default" onclick="save()"> Chrome Default: 
        <img src="image/default.png" alt="" /><br />
        <input type="radio" id="noneradio" name="imagetype" value="none" onclick="save()"> Nothing (tab text may look a bit misaligned)<br />
        <div id="fileinputs">
        <input type="radio" id="userradio" name="imagetype" value="user" onclick="save()"> Your own image
        <img id="userimagearea" />
        <input id="upload" type="file" onchange="loadImageFile();" />
        <div id="uploadtext">(click here to upload)</div>
        </div>
    </div>

    <div id="status">
    </div>
</body>
</html>
